---
layout: post
title: "Lidar 패키지 설치(2)"
date: 2025-11-26 20:00:00 +0900
categories: [Embedded System, Robotics]
tags: [Embedded, WSL2, ROS2, Jazzy, Lidar]
---



### **1. RViz를 통한 시각화**

Lidar 드라이버의 설치와 환경 설정이 완료되었다고 가정하고, ROS2의 **런치 파일(Launch File)**을 사용하여 Lidar 노드와 시각화 도구인 **RViz2**를 동시에 실행해 보겠습니다.



#### **1.1. 시각화 실행(Rviz2)**

Lidar 드라이버의 설치와 환경 설정이 완료되었다고 가정하고, ROS2의 **런치 파일(Launch File)**을 사용하여 Lidar 노드와 시각화 도구인 **RViz2**를 동시에 실행해 보겠습니다.

##### 1. **워크스페이스(`~/robot_ws`)**로 이동합니다.

```bash
cd ~/robot_ws
```

##### 2. **환경 변수**를 갱신하여 (재빌드 후라면 필수) 최신 패키지 정보를 반영합니다.

```bash
source install/setup.bash
```

##### 3. YDLidar의 일반 모델(X3, X4 등) 통합 런치 파일을 실행합니다.

```bash
ros2 launch ydlidar_ros2_driver ydlidar_launch_view.py
```

![Lidar_14](../images/2025-11-26-Lidar 패키지 설치(2)/Lidar_14.png)

### **2. 버전 불일치로 인한 문법 오류 수정**

런치 파일 실행 시, **`TypeError: LifecycleNode.__init__`** 오류가 발생할 수 있습니다. 이는 최신 ROS2 배포판(Jazzy)이 노드 정의 시 **`name`**과 **`namespace`** 인자를 필수적으로 요구하지만, 기존 YDLidar 런치 파일의 문법이 이를 따르지 않아 발생합니다.

#### **2.1. 실행 파일 열기**

코드 편집기(`VSCode`)를 사용하여 런치 파일(`ydlidar_launch_view.py`)을 엽니다.

```bash
code ~/robot_ws/src/ydlidar_ros2_driver/launch/ydlidar_launch_view.py
```

#### **2.2. 코드 수정**

런치 파일 내에서 **`Node`**를 정의하는 부분(특히 **`driver_node`**)에 **`name='node_name'`** 및 **`namespace='node_namespace'`** 인자를 추가하여 문법 오류를 수정합니다.

**[코드 수정]** 

- `driver_node`와 `tf2_node`의 정의 부분을 확인하여 `name`과 `namespace` 인자가 올바르게 전달되는지 확인합니다.

```python
def generate_launch_description():
    share_dir = get_package_share_directory('ydlidar_ros2_driver')
    rviz_config_file = os.path.join(share_dir, 'config','ydlidar.rviz')
    parameter_file = LaunchConfiguration('params_file')

    params_declare = DeclareLaunchArgument(
        'params_file',
        default_value=os.path.join(share_dir, 'params', 'ydlidar.yaml'),
        description='Path to the ROS2 parameters file to use.')

    # 1. 드라이버 노드 (LifecycleNode -> Node로 변경 및 파라미터 이름 최신화)
    driver_node = Node(
        package='ydlidar_ros2_driver',
        executable='ydlidar_ros2_driver_node', # node_executable -> executable
        name='ydlidar_ros2_driver_node',       # node_name -> name
        output='screen',
        emulate_tty=True,
        parameters=[parameter_file],
        namespace='/',
    )

    # 2. TF 퍼블리셔 (node_executable -> executable 등 최신 문법 적용)
    tf2_node = Node(
        package='tf2_ros',
        executable='static_transform_publisher',
        name='static_tf_pub_laser',
        arguments=['0', '0', '0.02','0', '0', '0', '1','base_link','laser_frame'],
    )

    # 3. RViz2 노드
    rviz2_node = Node(
        package='rviz2',
        executable='rviz2',
        name='rviz2',
        arguments=['-d', rviz_config_file],
    )

    return LaunchDescription([
        params_declare,
        driver_node,
        tf2_node,
        rviz2_node,
    ])
```

#### **2.3. 재빌드 및 환경 변수 갱신**

런치 파일의 Python 코드를 수정했더라도, ROS2 시스템이 이를 제대로 인식하도록 워크스페이스를 **재빌드**하고 **환경 변수**를 갱신합니다.

```bash
cd ~/robot_ws
colcon build --symlink-install
source install/setup.bash
```

#### **2.4. 실행**

```bash
ros2 launch ydlidar_ros2_driver ydlidar_launch_view.py
```



### **3. 설정 파일 (YAML) 수정 및 Lidar 감지**

런치 파일 오류를 수정한 후 다시 실행하면 RViz2는 실행되지만, Lidar 센서가 여전히 데이터를 감지하지 못하는 문제가 발생할 수 있습니다. 이는 장치(Lidar)의 실제 사양과 설정 파일(**`ydlidar.yaml`**)의 값이 일치하지 않기 때문입니다.

#### **3.1. 실행 및 오류 확인**

수정된 실행 파일을 다시 실행합니다.

```bash
ros2 launch ydlidar_ros2_driver ydlidar_launch_view.py
```

![Lidar_16](../images/2025-11-26-Lidar 패키지 설치(2)/Lidar_16.png)

터미널 출력 메시지에서 **Lidar 감지에 실패(Failed to detect Lidar)**했음을 확인합니다.

#### **3.2. YAML 파일 수정**

설정 파일을 열어 Lidar 모델에 맞는 파라미터로 수정합니다.

- 파일 경로: `~/robot_ws/src/ydlidar_ros2_driver/params/ydlidar.yaml`
- 수정할 주요 파라미터:
  - `baudrate`: **`115200`**으로 설정 (Lidar 사양에 맞춤)
  - `isSingleChannel`: **`false`**에서 **`true`**로 변경 (단일 채널 Lidar인 경우, **매우 중요**)
  - `port`: `/dev/ydlidar` (앞서 설정한 장치 이름이 맞는지 확인)

```yaml
ydlidar_ros2_driver_node:
  ros__parameters:
    port: /dev/ydlidar
    frame_id: laser_frame
    ignore_array: ""
    baudrate: 115200          # [수정 1] 115200으로 설정
    lidar_type: 1
    device_type: 0
    isSingleChannel: true     # [수정 2] false를 true로 변경 (핵심!)
    intensity: false
    intensity_bit: 0
    sample_rate: 5
    abnormal_check_count: 4
    fixed_resolution: true
    reversion: true
    inverted: true
    auto_reconnect: true
    support_motor_dtr: true
    # ... (나머지 그대로)
```

#### **3.3. 최종 실행 및 시각화 확인**

수정된 YAML 파일은 재빌드 과정이 필요 없으며, 바로 적용됩니다. 런치 파일을 다시 실행하여 Lidar가 정상적으로 감지되는지 확인합니다.

```bash
ros2 launch ydlidar_ros2_driver ydlidar_launch_view.py
```

![image-20251126213416843](../images/2025-11-26-Lidar 패키지 설치(2)/image-20251126213416843.png)

성공적으로 실행되면, 터미널에 **`Successful to check the Lidar`** 메시지가 출력되며, RViz2 화면에서 Lidar의 **점 구름(Point Cloud)** 데이터가 시각화되는 것을 확인할 수 있습니다.



### **4. 마무리**

지금까지 ROS2 Jazzy 환경에서 YDLidar 패키지를 설치하고, 발생 가능한 버전 불일치 오류와 장치 인식 문제를 해결하는 과정을 상세하게 다루었습니다.

WSL2 환경에서의 USB 장치 연결(`usbipd`)부터 시작하여, 드라이버 노드의 소스 코드 오류, 그리고 런치 파일과 YAML 설정 파일 수정에 이르기까지, 여러 난관을 극복하고 마침내 **RViz2에서 Lidar 데이터를 성공적으로 시각화**하는 데 성공했습니다.

이 가이드가 ROS2 기반 로봇 개발자들에게 큰 도움이 되기를 바라며, 다음 포스트에서는 이 Lidar 데이터를 활용하여 **SLAM(동시적 위치 추정 및 지도 작성)**을 구현하는 방법을 다룰 예정입니다. 많은 기대 부탁드립니다!
